!function(){"use strict";var w={isNumeric:function(e){return!isNaN(e)&&isFinite(e)&&!(1<e.length&&"0"===e.substring(0,1))},excelValue:function(e){if(""===(e=e.trim()))return null;if(w.isNumeric(e))return parseFloat(e);var t=new Date(e);return!isNaN(t.getTime())&&0<t.getYear()&&(e.includes("-")||e.includes(",")||e.includes("/"))?t:e},downloadExcelJS:function(e){var t;void 0===window.ExcelJS?(-1!==navigator.userAgent.indexOf("Trident/")&&w.polyfill_IE(),(t=document.createElement("script")).src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js",t.onload=e,document.querySelector("head").appendChild(t)):e()},polyfill_IE:function(){var n=window.RegExp;try{new n("a","u")}catch(e){window.RegExp=function(e,t){return"string"==typeof t&&!0===t.includes("u")&&(t="u"===t?void 0:t.replace("u",""),e=(e=e.replace(/\uDC00-\uDBFF/g,"")).replace(/\uDC00-\uDB7F/g,"")),new n(e,t)},window.RegExp.prototype=n}},hasInvalidFileNameChars:function(e){for(var t=['"',"<",">","|",":","*","?","\\","/"],n=0;n<t.length;n++)if(e.includes(t[n]))return!0;for(var r=0;r<32;r++)if(e.includes(String.fromCharCode(r)))return!0;return!1},exportTable:function(x){var b="data-running-export";null===x.getAttribute(b)&&(x.setAttribute(b,""),"BUTTON"===x.nodeName&&(x.disabled=!0),w.downloadExcelJS(function(){var e=x.getAttribute("data-export-excel-selector");if((n=x.getAttribute("data-export-file-name"))&&(n.length<=5||!n.endsWith(".xlsx")||w.hasInvalidFileNameChars(n)))app.showErrorAlert("Attribute [data-export-file-name] must be a valid name with file type [*.xlsx]");else{for(var s,t,n=n||"Report.xlsx",r=x.getAttribute("data-worksheet-name"),c=(31<(r=r||n.substring(0,n.length-5)).length&&(r=r.substring(0,31)),null!==x.getAttribute("data-export-all")),e=document.querySelector(e),l=[],o=[],a=[],i=e.tHead.rows[0],u=0;u<i.cells.length;u++){var p=i.cells[u].textContent,p=(a.push(p),p.trim().length),d=parseInt(Math.max(1.2*p,p+4));o.push(d)}l.push(a);for(var f=e.tBodies[0].rows,g=0,h=f.length;g<h;g++)if(i=f[g],c||"none"!==i.style.display){for(a=[],u=0;u<i.cells.length;u++)d=(t=null===(t=(s=i.cells[u]).getAttribute("data-value"))?s.textContent:t).trim().length,(t=w.excelValue(t))instanceof Date?d=12:"number"==typeof t&&(d=t.toString().length+2),o[u]=Math.max(o[u],d),a.push(t);l.push(a)}var e=new ExcelJS.Workbook,m=e.addWorksheet(r);for(u=0;u<l.length;u++)m.addRow(l[u]);var v=m.getRow(1);for(u=0;u<o.length;u++)(s=v.getCell(u+1)).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF2F2F2"}},s.font={bold:!0};for(u=0;u<o.length;u++)m.getColumn(u+1).width=Math.min(50,o[u]);m.autoFilter={from:{row:1,column:1},to:{row:l.length,column:o.length}},m.views=[{state:"frozen",ySplit:1}],e.xlsx.writeBuffer().then(function(e){var t,e=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});void 0!==navigator.msSaveBlob?navigator.msSaveBlob(e,n):(t=document.createElement("a"),e=URL.createObjectURL(e),t.setAttribute("href",e),t.setAttribute("download",n),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)),x.removeAttribute(b),"BUTTON"===x.nodeName&&(x.disabled=!1)})}}))},onRendered:function(e){var t,e=(e||document).querySelectorAll("[data-export-excel-selector]"),n=!1;0<e.length&&(null===(t=document.querySelector("a"))&&(t=document.createElement("a")),n=void 0!==navigator.msSaveBlob||void 0!==t.download),Array.prototype.forEach.call(e,function(e){n?e.onclick=function(){w.exportTable(e)}:e.style.display="none"})}};app.addPlugin("exportToExcel",w)}();
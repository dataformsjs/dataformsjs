const markdownCache=[],maxCacheSize=100;function saveMarkdownToCache(t,e,r){markdownCache.length>100&&(markdownCache.length=0);for(let e=0,r=markdownCache.length;e<r;e++)if(t===markdownCache[e].url)return;markdownCache.push({url:t,content:e,errorMessage:r})}function getMarkdownFromCache(t){for(let e=0,r=markdownCache.length;e<r;e++)if(t===markdownCache[e].url)return markdownCache[e];return null}window.Markdown = class Markdown extends React.Component{constructor(t){super(t);const e=void 0!==t&&"string"==typeof t.content;this.state={content:e?t.content:null,html:e?this.generateHtml(t.content):null,errorMessage:null,isLoaded:!1},this._isMounted=!1,this._returnCode=!1,this.fetchContent=this.fetchContent.bind(this),this.highlight=this.highlight.bind(this),this.updateContent=this.updateContent.bind(this),this.generateHtml=this.generateHtml.bind(this),this.markdownEl=React.createRef()}componentDidMount(){this._isMounted=!0,this.props.url&&null===this.state.content?this.fetchContent():this.updateContent()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(t){this.props.url&&t.url!==this.props.url?this.fetchContent():this.updateContent()}fetchContent(){if(this.props.loadOnlyOnce){const t=getMarkdownFromCache(this.props.url);if(t)return void(this._isMounted&&this.setState({content:t.content,html:this.generateHtml(t.content),errorMessage:t.errorMessage,isLoaded:!0}))}fetch(this.props.url,this.props.fetchOptions).then((t=>{const e=t.status;if(e>=200&&e<300||304===e)return Promise.resolve(t);{const r=`Error loading markdown content from [${this.props.url}]. Server Response Code: ${e}, Response Text: ${t.statusText}`;return Promise.reject(r)}})).then((t=>t.text())).then((t=>{this.props.loadOnlyOnce&&saveMarkdownToCache(this.props.url,t,null),this._isMounted&&this.setState({content:t,html:this.generateHtml(t),errorMessage:null,isLoaded:!0})})).catch((t=>{this.props.loadOnlyOnce&&saveMarkdownToCache(this.props.url,null,t),this._isMounted&&this.setState({errorMessage:t})}))}highlight(t,e){const r=this.props.hljs||window.hljs;if(void 0===r)return this._returnCode?t:"";if(e&&r.getLanguage(e))try{return r.highlight(e,t).value}catch(t){console.warn(t)}try{return r.highlightAuto(t).value}catch(t){console.warn(t)}return this._returnCode?t:""}updateContent(){if(!this._isMounted||!this.markdownEl.current)return;if(void 0!==(this.props.hljs||window.hljs)){const t=this.markdownEl.current.querySelectorAll('code[class*="language-"]');for(let e=0,r=t.length;e<r;e++)t[e].classList.add("hljs")}const t=this.props.linkTarget,e=this.props.linkRel;if(t||e){const r=this.markdownEl.current.querySelectorAll("a");Array.prototype.forEach.call(r,(function(r){r.target=t||r.target,r.rel=e||r.rel}))}if(!1!==this.props.useRootUrl){const t=this.props.url;let e;if(t){const r=t.split("/");e=t.substr(0,t.length-r[r.length-1].length)}let r=this.props.linkRootUrl;if(r=r||e,r){const t=this.markdownEl.current.querySelectorAll('a:not([href^="http:"]):not([href^="https:"])');Array.prototype.forEach.call(t,(function(t){const e=t.getAttribute("href");t.setAttribute("data-original-href",e),t.setAttribute("href",r+e)}))}const s=this.markdownEl.current.querySelectorAll('img:not([src^="http:"]):not([src^="https:"])');Array.prototype.forEach.call(s,(function(t){const r=t.getAttribute("src");t.setAttribute("data-original-src",r),t.setAttribute("src",e+r)}))}}generateHtml(t){let e,r;if(this._returnCode=!1,this.props.marked||window.marked){this._returnCode=!0;const r=this.props.marked||window.marked;r.setOptions({highlight:this.highlight}),e=r(t)}else if(this.props.markdownit||window.markdownit){if(r=(this.props.markdownit||window.markdownit)({html:!0,linkify:!0,typographer:!0,highlight:this.highlight}),this.props.markdownitEmoji||window.markdownitEmoji){const t=this.props.markdownitEmoji||window.markdownitEmoji;r.use(t)}e=r.render(t)}else{if(!this.props.Remarkable&&!window.remarkable)throw new Error("Error - Unable to show Markdown content because a Markdown JavaScript library was not found on the page.");{r=new(this.props.Remarkable||window.remarkable.Remarkable)({html:!0,typographer:!0,highlight:this.highlight});const s=this.props.linkify||window.remarkable.linkify;s&&r.use(s),e=r.render(t)}}const s=this.props.DOMPurify||window.DOMPurify;return void 0!==s&&(e=s.sanitize(e)),e}render(){if(this.state.errorMessage){const t=(this.props.className?this.props.className:"")+" error",e="object"==typeof this.props.errorStyle?this.props.errorStyle:{backgroundColor:"red",color:"#fff",fontWeight:"bold",border:"1px solid darkred",padding:"1em"};return React.createElement("div",{className:t,ref:this.markdownEl,style:e},this.state.errorMessage)}return this.props.url&&!this.state.isLoaded?this.props.isLoading?this.props.isLoading:null:null===this.state.content?null:this.props.showSource?React.createElement("div",{className:this.props.className,ref:this.markdownEl},React.createElement("pre",null,this.state.content)):React.createElement("div",{className:this.props.className,dangerouslySetInnerHTML:{__html:this.state.html},ref:this.markdownEl})}}
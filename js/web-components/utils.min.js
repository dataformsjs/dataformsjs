import{Format}from"./utils-format.min.js";let polyfillIsNeeded=null;const errorStyleId="dataformsjs-style-errors",errorCss="\n    .dataformsjs-error,\n    .dataformsjs-fatal-error {\n        color:#fff;\n        background-color:red;\n        box-shadow:0 1px 5px 0 rgba(0,0,0,.5);\n        background-image:linear-gradient(#e00,#c00);\n        text-align: left;\n    }\n\n    .dataformsjs-error{\n        padding:10px;\n        font-size:1em;\n        margin:5px;\n        display:inline-block;\n    }\n\n    .dataformsjs-fatal-error {\n        z-index:1000000;\n        padding:20px;\n        font-size:1.5em;\n        margin:20px;\n        position:fixed;\n        top:10px;\n    }\n\n    @media only screen and (min-width:1000px){\n        .dataformsjs-fatal-error {\n            max-width:1000px;\n            left:calc(50% - 520px);\n        }\n    }\n\n    .dataformsjs-fatal-error span {\n        padding:5px 10px;\n        float:right;\n        border:1px solid darkred;\n        cursor:pointer;\n        margin-left:10px;\n        box-shadow:0 0 2px 1px rgba(0,0,0,0.3);\n        background-image:linear-gradient(#c00,#a00);\n        border-radius:5px;\n    }\n";export function escapeHtml(e){return null==e||"number"==typeof e?e:String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}export function render(e,...t){const n=[e[0]];for(let o=0,r=t.length;o<r;o++)n.push(escapeHtml(t[o])),n.push(e[o+1]);return n.join("")}export function buildUrl(e,t){let n=String(e);if(n=n.replace(/\{(\w+)\}/g,(function(e,t){return"string"==typeof window[t]?window[t]:e})),null!==t&&"object"==typeof t)for(const e in t)t.hasOwnProperty(e)&&n.indexOf(":"+e)>-1&&(n=n.replace(new RegExp(":"+e,"g"),encodeURIComponent(t[e])));return n}export function setElementText(e,t){if(!(e instanceof HTMLElement||e instanceof SVGElement))return void console.warn("Called setElementText() with an invalid parameter");const n=e.nodeName.toLowerCase();switch(n){case"input":if("checkbox"===e.type){const n=String(t).toLowerCase();e.checked="true"===n||"1"===n||"yes"===n||"y"===n}else e.value=null===t?"":String(t);break;case"select":case"textarea":e.value=null===t?"":String(t);break;default:if(n.includes("-")||e.hasAttribute("is"))if("value"in e)e.value=t;else{const o=n.includes("-"),r=o?n:e.getAttribute("is");if(void 0!==window.customElements.get(r))e.textContent=null===t?"":String(t);else{showError(e,`Error - Web Component ${o?`<${r}>`:`<${n} is="${r}">`} is not defined; the related JavaScript file might be missing from this page.`)}}else e.textContent=null===t?"":String(t)}}export function getBindValue(e,t){const n=t.split(".");let o=n.length>1&&"window"===n[0]?window:e;for(let e=0,t=n.length;e<t;e++)o="object"==typeof o&&null!==o?o[n[e]]:null;return void 0===o?null:o}export function formatData(e,t){const n=e.getAttribute("data-format");if(null===n)return t;if("function"==typeof Format.prototype[n]){return(new Format)[n](t)}if("function"!=typeof window[n])return"Error: Unknown format ["+n+"]";try{return window[n](t)}catch(e){return console.error(e),"Error: "+e.message}}export function bindAttrTmpl(e,t,n){const o=e.getAttribute(t).split(",").map((e=>e.trim()));for(const r of o){let o=e.getAttribute(t+"-"+r);if(null===o&&(o=e.getAttribute(r),null!==o&&e.setAttribute(t+"-"+r,o)),null!==o){let t=0;const l=100;for(;t<l;){const e=o.indexOf("["),r=o.indexOf("]");if(-1===e||-1===r||r<e)break;let l=getBindValue(n,o.substring(e+1,r));void 0===l&&(l=""),o=o.substring(0,e)+l+o.substring(r+1),t++}e.setAttribute(r,o)}}}export function showError(e,t){if(null===e)return void showErrorAlert(t);loadCss(errorStyleId,errorCss);const n=document.createElement("span");n.className="dataformsjs-error",n.textContent=t,e.innerHTML="",e.appendChild(n),"string"!=typeof t&&console.error(t)}export function showErrorAlert(e){loadCss(errorStyleId,errorCss);let t=e;"string"==typeof t&&-1===t.toLowerCase().indexOf("error")&&(t="Error: "+t);const n=document.createElement("div");n.className="dataformsjs-fatal-error",n.textContent=t;const o=document.createElement("span");o.textContent="âœ•",o.onclick=e=>{document.body.removeChild(e.target.parentNode)},n.insertBefore(o,n.firstChild),document.body.appendChild(n),"string"!=typeof e&&console.error(e)}export function loadCss(e,t){let n=document.getElementById(e);null===n&&(n=document.createElement("style"),n.id=e,n.innerHTML=t,document.head.appendChild(n))}export function polyfillCustomElements(e=document){if(null===polyfillIsNeeded)if(void 0===window._webComponentPolyfillIsNeeded){class e extends HTMLDivElement{}void 0===window.customElements.get("web-component-polyfill-check")&&window.customElements.define("web-component-polyfill-check",e,{extends:"div"});let t=document.querySelector("body");t||(t=document.documentElement),t.insertAdjacentHTML("beforeend",'<div is="web-component-polyfill-check"></div>');const n=document.querySelector('div[is="web-component-polyfill-check"]');polyfillIsNeeded=!(n instanceof e),t.removeChild(n),window._webComponentPolyfillIsNeeded=polyfillIsNeeded}else polyfillIsNeeded=window._webComponentPolyfillIsNeeded;if(polyfillIsNeeded&&Array.isArray(window._webComponentPolyfills))for(const t of window._webComponentPolyfills){const n=e.querySelectorAll(`${t.extendsElement}[is="${t.element}"]`);for(const e of n)try{t.setup(e)}catch(n){showErrorAlert(n),console.log(t.element),console.log(e)}}}export function defineExtendsPolyfill(e,t,n){window._webComponentPolyfills=window._webComponentPolyfills||[],window._webComponentPolyfills.push({element:e,extendsElement:t,setup:n}),document.addEventListener("DOMContentLoaded",runPolyfill)}function runPolyfill(){polyfillCustomElements(document)}export function componentsAreDefined(e,t=""){return new Promise((async n=>{const o=e.querySelectorAll(t+":not(:defined)");if(o.length>0){const e=[...o].map((e=>window.customElements.whenDefined(e.getAttribute("is")||e.localName))),t=new Promise((e=>{window.setTimeout((()=>{e()}),1e3)}));await Promise.race([Promise.all(e),t])}n()}))}export function isAttachedToDom(e){let t=e.parentNode;for(;null!==t;)if(t=t.parentNode,t===document)return!0;return!1}
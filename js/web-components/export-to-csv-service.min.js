import{WebComponentService}from"./WebComponentService.min.js";import{showErrorAlert}from"./utils.min.js";function csvEscape(e){return(e=e.replace(/"/g,'""')).search(/("|,|\n|:)/g)>=0&&(e='"'+e+'"'),e}function exportTable(e){let t=e.target.getAttribute("data-export-csv-selector"),o=e.target.getAttribute("data-export-file-name");o=o||"Report.csv";const n=null!==e.target.getAttribute("data-export-all"),l=document.querySelector(t),r=[];let s=[],a=l.tHead.rows[0];for(let e=0,t=a.cells.length;e<t;e++)s.push(csvEscape(a.cells[e].textContent));r.push(s.join(","));const c=l.tBodies[0].rows;for(let e=0,t=c.length;e<t;e++)if(a=c[e],n||"none"!==a.style.display){s=[];for(let e=0,t=a.cells.length;e<t;e++){const t=a.cells[e];let o=t.getAttribute("data-value");null===o&&(o=t.textContent),s.push(csvEscape(o))}r.push(s.join(","))}const i=r.join("\r\n"),d=new Blob([i],{type:"text/csv; charset=utf-8;"});if(void 0!==navigator.msSaveBlob)navigator.msSaveBlob(d,o);else{const e=document.createElement("a");if(void 0!==e.download){const t=URL.createObjectURL(d);e.setAttribute("href",t),e.setAttribute("download",o),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else{showErrorAlert("Unable to Export as a CSV File. Try a different browser and if you need help then please contact support.")}}}window.customElements.define("export-to-csv-service",class extends WebComponentService{onLoad(){const e=document.querySelectorAll("[data-export-csv-selector]");let t=!1;if(e.length>0){let e=document.querySelector("a");null===e&&(e=document.createElement("a")),t=void 0!==navigator.msSaveBlob||void 0!==e.download}for(const o of e)t?o.addEventListener("click",exportTable):o.style.display="none"}});
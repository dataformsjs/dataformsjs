!function(){"use strict";var e=app.deepClone({},app.pages.jsonData);Object.assign(e.model,{newRecord:!1,recordDeleted:!1,fieldSelector:'input[id^="field-"],input[name^="field-"],select[id^="field-"],select[name^="field-"],textarea[id^="field-"],textarea[name^="field-"]',saveButtonSelector:".btn-save",deleteButtonSelector:".btn-delete",infoSelector:".info-message",errorSelector:".error-message",errorListSelector:".error-list",saveUrl:null,deleteUrl:null,useSaveApi:!0,newRecordRedirectUrl:null,updateRecordRedirectUrl:null,deleteRecordRedirectUrl:null,resultSuccessDisplayInterval:2e3,deleteRecordRedirectInterval:1e3,savingRecordText:"Saving Record...",deletingRecordText:"Deleting Record...",recordSavedText:"Record saved at {time}",recordDeletedText:"Record deleted at {time}",confirmDeleteText:"Are you sure that you want to delete this record?",onFormLoaded:null,onFormBeforeSave:null,onFormAfterSave:null,onFormAfterDelete:null,onFormSaveError:null,onFormDeleteError:null,loadFormFields:function(){var e,o=this;o.newRecord||(e=document.querySelectorAll(o.fieldSelector),Array.prototype.forEach.call(e,function(e){var t=e.nodeName;"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t||null===e.getAttribute("data-keep-default")&&(0===(t=0===e.id.indexOf("field-")?e.id:e.name).indexOf("field-")&&(t=t.substring(6)),t=void 0!==o[t]?o[t]:"","checkbox"===e.type?(t=String(t).toLowerCase(),e.checked="true"===t||"1"===t||"yes"===t||"y"===t):e.value=null===t?"":t)}),void 0!==app.events&&"function"==typeof app.events.dispatch&&app.events.dispatch("entryForm.loadedFormFields"))},setButtonEvents:function(){var e;this.hideInfo(),this.hideError(),""!==this.saveButtonSelector&&null!==(e=document.querySelector(this.saveButtonSelector))&&(this.recordDeleted?(e.style.display="none",e.onclick=null):(e.onclick=this.saveRecord.bind(this),e.disabled&&(e.disabled=!1))),""!==this.deleteButtonSelector&&null!==(e=document.querySelector(this.deleteButtonSelector))&&(this.recordDeleted?(e.style.display="none",e.onclick=null):this.newRecord?e.style.display="none":(e.onclick=this.deleteRecord.bind(this),e.disabled&&(e.disabled=!1)))},updateCssElements:function(){var e=document.querySelectorAll(".hide-after-form-load");Array.prototype.forEach.call(e,function(e){e.style.display="none"}),e=document.querySelectorAll(".show-after-form-load"),Array.prototype.forEach.call(e,function(e){null!==e.getAttribute("hidden")?e.removeAttribute("hidden"):e.style.display=""})},showInfo:function(e,t,o){var r=this,l=document.querySelector(this.infoSelector);null!==l&&(l.textContent=e,l.style.display="",t&&window.setTimeout(function(){l.style.display="none",r.enableButtons(!0),o&&o()},parseInt(t,10)))},hideInfo:function(){var e=document.querySelector(this.infoSelector);null!==e&&(e.style.display="none")},showError:function(e){var t=document.querySelector(this.errorSelector);null!==t?(t.textContent=e,t.style.display=""):app.showErrorAlert(e)},showErrorList:function(e){var t=document.querySelector(this.errorListSelector);if(null!==t&&"UL"===t.nodeName){t.innerHTML="";for(var o=0,r=e.length;o<r;o++){var l=document.createElement("li");l.textContent=e[o],t.appendChild(l)}t.style.display=""}else this.showError(e.join(" "))},hideError:function(){var e=document.querySelector(this.errorSelector);null!==e&&(e.style.display="none"),null!==(e=document.querySelector(this.errorListSelector))&&(e.style.display="none")},enableButtons:function(t){[this.saveButtonSelector,this.deleteButtonSelector].forEach(function(e){e=document.querySelector(e);null!==e&&(e.disabled=!t)})},getRecord:function(){var l={},n=[],i=void 0!==app.validation&&"function"==typeof app.validation.validateInput?app.validation.validateInput:null,e=document.querySelectorAll(this.fieldSelector);return Array.prototype.forEach.call(e,function(e){var t=0===e.name.indexOf("field-")?e.name:e.id;0===t.indexOf("field-")&&(t=t.substring(6));var o,r=e.getAttribute("data-value");null===r&&(r="checkbox"===e.type?e.checked:e.value),""!==r&&("int"===(o=e.getAttribute("data-type"))?(r=parseInt(r,10),isNaN(r)&&(r=null)):"float"===o&&(r=parseFloat(r),isNaN(r)&&(r=null))),""===r&&(r=null),!i||(e=i(e,t))&&n.push(e),l[t]=r}),void 0!==app.plugins.listEditor&&"function"==typeof app.plugins.listEditor.listSelector&&"function"==typeof app.plugins.listEditor.validate&&(i&&(n=n.concat(app.plugins.listEditor.validate())),e=app.plugins.listEditor.listSelector(),e=document.querySelectorAll(e),Array.prototype.forEach.call(e,function(e){e=e.getAttribute("data-edit-list");null!==e&&(app.activeVueModel&&void 0!==app.activeVueModel[e]&&Array.isArray(app.activeVueModel[e])?l[e]=app.activeVueModel[e]:void 0!==app.activeModel[e]&&Array.isArray(app.activeModel[e])&&(l[e]=app.activeModel[e]))})),{record:l,errors:n}},saveRecord:function(e){var i=this;e&&e.preventDefault&&e.preventDefault();var t=i.getRecord(),e=t.record;0!==Object.keys(e).length?null!==i.saveUrl&&""!==i.saveUrl?0<t.errors.length?i.showErrorList(t.errors):"function"==typeof i.onFormBeforeSave&&!i.onFormBeforeSave(e)||(Object.assign(i,e),i.enableButtons(!1),i.hideError(),i.showInfo(i.savingRecordText),t=app.buildUrl(i.saveUrl,i),app.fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(t){var o=!1;if(!i.useSaveApi||t.success){i.newRecord&&(o=!0),i.newRecord=!1;var e=i.useSaveApi?t.fields:t;if(void 0!==e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);null!==app.activeVueModel?app.activeVueModel.$nextTick(function(){i.loadFormFields()}):i.loadFormFields(),i.setButtonEvents(),null===app.activeVueModel&&app.refreshAllHtmlControls(function(){app.loadAllJsControls()})}var l="string"==typeof t.result?t.result:i.recordSavedText,n=(n=new Date).toLocaleTimeString?n.toLocaleTimeString():n.toTimeString(),l=l.replace(/{time}/g,n);i.showInfo(l,i.resultSuccessDisplayInterval,function(){var e=o?i.newRecordRedirectUrl:i.updateRecordRedirectUrl;null!==e&&(null===app.activeVueModel?app.activeModel:app.activeVueModel)===i&&(void 0!==t.fields&&(app.activeParameterList=t.fields),0===(e=app.buildUrl(e)).indexOf("#")?window.location.hash=e:window.location=e)}),"function"==typeof i.onFormAfterSave&&i.onFormAfterSave()}else{i.setButtonEvents();l=void 0===t.errorMessage?null:t.errorMessage;null===l&&i.useSaveApi&&void 0===t.success&&(l='Error - Save/Submit Web Service did not return the expected [success] property. If not using the standard entry form API use either [data-use-save-api="false"] or [model.useSaveApi = false].'),i.showError(l)}}).catch(function(e){i.setButtonEvents(),i.showError(e),"function"==typeof i.onFormSaveError&&i.onFormSaveError(e)})):i.showError("Error - Unable to save. The property [entryForm.saveUrl] or [data-save-url] is not defined."):i.showError("Error - Unable to save. No fields were found on the page.")},deleteRecord:function(e){var r=this;if(e&&e.preventDefault&&e.preventDefault(),null!==r.deleteUrl&&""!==r.deleteUrl){var t=app.buildUrl(r.deleteUrl),e=null;if(t===r.deleteUrl){e=r.getRecord().record;if(0===Object.keys(e).length)return void r.showError("Error - Unable to delete. No fields were found on the page.");e=JSON.stringify(e)}r.confirmDeleteText&&!confirm(r.confirmDeleteText)||(r.enableButtons(!1),r.hideError(),r.showInfo(r.deletingRecordText),app.fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:e}).then(function(t){var e,o;t.success?(r.recordDeleted=!0,r.setButtonEvents(),o="string"==typeof t.result?t.result:r.recordDeletedText,e=(e=new Date).toLocaleTimeString?e.toLocaleTimeString():e.toTimeString(),o=o.replace(/{time}/g,e),r.showInfo(o),"function"==typeof r.onFormAfterDelete&&r.onFormAfterDelete(),null!==r.deleteRecordRedirectUrl&&window.setTimeout(function(){var e;(null===app.activeVueModel?app.activeModel:app.activeVueModel)===r&&(void 0!==t.fields&&(app.activeParameterList=t.fields),0===(e=app.buildUrl(r.deleteRecordRedirectUrl)).indexOf("#")?window.location.hash=e:window.location=e)},r.deleteRecordRedirectInterval)):(r.setButtonEvents(),r.showError(void 0===t.errorMessage?null:t.errorMessage))}).catch(function(e){r.setButtonEvents(),r.showError(e),"function"==typeof r.onFormDeleteError&&r.onFormDeleteError(e)}))}else r.showError("Error - Unable to save. The property [entryForm.deleteUrl] or [data-delete-url] is not defined.")},setupView:function(){this.loadFormFields(),this.setButtonEvents(),this.updateCssElements(),"function"==typeof this.onFormLoaded&&this.onFormLoaded()}}),e.onRouteLoad=function(){if(this.newRecord&&!this.url)return this.isLoaded=!0,this.hasError=!1,void this.setViewClass("loaded");app.pages.jsonData.onRouteLoad.call(this)},e.onRendered=function(){this.isLoaded&&this.setupView()},app.addPage("entryForm",e)}();